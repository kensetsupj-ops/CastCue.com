# CastCue サイドバー要件定義（MVP）
Version: 0.2 / Date: 2025-10-09 / TZ: Asia/Tokyo

> サイドバーに **MVPで表示する項目のみ** と、それぞれのページに **載せる内容/載せない内容/受入基準** を定義します。Twitter連携を前提。Discord・残量・自動切替の可視化は行いません。

---

## 0) 対象（MVPでサイドバーに表示）
1. **ダッシュボード**（/dashboard）
2. **レポート**（/reports）
3. **配信一覧**（/streams）
4. **テンプレート**（/templates）
5. **連携**（/integrations）
6. **設定**（/settings）

> **非表示（将来）**：リンク／タスク／ユーザー／料金  
> ルーティングは温存（Feature Flagで有効化可能）。

---

## 1) 共通ナビ要件
- **日本語ラベル**。英語切替は設定＞言語で。
- **UI制約**：ダークUI。**グラデーション・絵文字は使用しない**。lucide-reactアイコン（線2px）。
- **レイアウト**：幅 280px 固定。`md`未満はアイコンのみ→クリックで展開。
- **状態表示**：アクティブは1段明るい面＋ボーダー。**連携**が未接続なら警告ドット。
- **A11y**：キーボード操作（↑↓/Enter）、フォーカスリング、ARIAラベル。
- **計測**：`nav_click` を発火（item, previous_item）。

---

## 2) ページ別要件

### 2.1 ダッシュボード（/dashboard）
**目的**：今日の成果を一目で把握し、次の行動につなげる。

- **ヒーロー**
  - **承認待ちの下書き**：`N件`。CTA：**編集して投稿**（/approve/[draftId]）。
  - **次のおすすめ**：例 `19:05 に テンプレB で告知すると伸びやすい見込み`（1行）。
- **今日の成果（カード2枚）**
  - **今日の告知で呼べた人（推定）**：補足文 `告知前5分と10分後の同接を比較して推定`。
  - **リンクを押した人**：合計と **告知あたり平均** を併記。
- **何が効いた？（勝ちパターン）**
  - **一番効いた文面**：テンプレ名＋本文先頭30文字／`+◯人・クリック◯`。
  - **強い時間帯**：`19:00–20:00 が最近強い（平均 +◯人）`。
  - **テンプレ別の勝率（A/B）**：例 `B 62%`。
- **今日の流れ（グラフ）**
  - 折れ線1枚：**同接**と**クリック**。**告知マーカー**にホバーで本文先頭と推定増加を表示。
- **最近の告知（表10件）**
  - 列：**時刻｜文面（先頭）｜クリック｜増えた人（推定）｜結果（送信済み/失敗）**。
  - 行アクション：**この文面でまた投稿**（編集画面プリセット）。
- **アラート**
  - **Xの連携が切れています**（再接続導線）
  - **ブラウザ通知が無効です**（有効化導線）

**載せない**：告知の速さ／自動投稿の状態／今月の残り回数／チャンネル比較。

**受入基準**：カードは2枚のみ。上記の「載せない」項目が出ていないこと。

---

### 2.2 レポート（/reports）
**目的**：告知単位の深掘り・比較・出力。

- **フィルタ**：期間（今日/7日/30日/カスタム）／テンプレート／バリアント（A/B）／検索（本文）。
- **テーブル**：`投稿ID｜日時｜テンプレート｜バリアント｜クリック｜増えた人（推定）｜変換率（リフト/クリック）｜結果`。
- **行詳細**：告知±15分の同接ミニグラフ＋Raw Log（送信レスポンス/再試行）。
- **アクション**：**CSVエクスポート**／**この文面でまた投稿**。

**載せない**：インプレッション依存のCTR（将来切替可）。

**受入基準**：上記列が揃い、CSV出力・再投稿アクションが動作。

---

### 2.3 配信一覧（/streams）
**目的**：配信（番組）単位の俯瞰と推移確認。

- **テーブル**：`開始｜推定終了｜配信時間｜ピーク同接｜ピーク到達時間｜視聴時間概算`。
- **詳細**：同日のサンプル折れ線＋告知マーカー重ね合わせ／関連告知リンク。

**載せない**：他プラットフォーム統計（YouTube等）。

**受入基準**：列が揃い、詳細で推移と告知のタイミングが確認できる。

---

### 2.4 テンプレート（/templates）
**目的**：告知文面の管理とA/B運用。

- **一覧**：テンプレート名／バリアント／使用回数／直近30日の勝率。
- **エディタ**：本文（`{title} {category} {twitch_url}` 補完）／揺らぎON/OFF／プレビュー。
- **A/B**：A/B比率は **50/50固定**（MVP）。

**載せない**：画像アップロード（サムネはTwitchプレビュー or なし）。

**受入基準**：一覧・編集・A/B反映が機能する。

---

### 2.5 連携（/integrations）
**目的**：Xの接続/解除と状態確認。

- **X**：
  - **接続／解除／再接続** と **権限**（`tweet.write users.read offline.access`）表示。
  - **接続テスト**（疎通チェック）と失効時の復旧ガイド。

**載せない**：Discord/YouTubeのUI。

**受入基準**：接続→投稿可能／解除→投稿不可 に即時反映。

---

### 2.6 設定（/settings）
**目的**：個人設定と安全管理（“削除”は提供しない）。

- **プロフィール**：Twitchから同期（表示名/アイコン等）。**読み取り専用**。
- **通知**：Web Push有効化（PWA）。
- **レビュー承認モード**：猶予タイマー、未承認時の挙動（自動投稿 or スキップ）。
- **セキュリティ**：**ログアウト**、各連携の**解除**（Twitch/X）。
- **データ**：保持期間（90日）表示、エクスポート。

**載せない**：アカウント削除。

**受入基準**：上記の通りで、アカウント削除がUIに存在しない。

---

## 3) サイドバー表示順・ルール
1. ダッシュボード
2. レポート
3. 配信一覧
4. テンプレート
5. 連携（未接続時は警告ドット）
6. 設定

- 検索フィールドは**初期は非表示**（データ量が増えたら有効化）。
- 非表示ページ（リンク/タスク/ユーザー/料金）は**Feature Flag**で有効化可能にし、直アクセスはガード。

---

## 4) 遷移・トースト
- サイドバークリックで各 `/path` に遷移、**URLクエリにフィルタを保持**。
- 連携の接続/解除後は直前ページへ戻し、**トースト**で結果通知（例：`接続しました`）。
- ダッシュボードの「この文面でまた投稿」で **/approve/[draftId]** をプリセット起動。

---

## 5) 品質・A11y・パフォーマンス
- コントラスト比 AA、フォーカストラップ、キーボード操作◎。
- 初回LCP ≤ 2.5s（`lg`）。チャートは遅延ロード。
- 空状態/エラー/ローディングSkeletonを全ページに用意。

---

## 6) 受入基準（サイドバー）
- [ ] サイドバーが**6項目のみ**（ダッシュボード/レポート/配信一覧/テンプレート/連携/設定）。
- [ ] 非表示項目（リンク/タスク/ユーザー/料金）が **表示されない** かつ **URL直叩きも拒否**。
- [ ] 連携未接続時、**連携**に警告ドットが出る。
- [ ] すべてのページで**日本語ラベル**かつ **グラデーション/絵文字なし**。
- [ ] 主要導線（編集して投稿、X接続/解除、ログアウト）が機能する。

---

## 7) 受入基準（ページ別）

### 7.1 ダッシュボード
- [ ] **承認待ちの下書き**が `N件` 表示され、**「編集して投稿」**で `/approve/[draftId]` が開く。
- [ ] **次のおすすめ**が1行で表示される（例文形式でOK、非表示になっていない）。
- [ ] **カードは2枚のみ**（「今日の告知で呼べた人（推定）」「リンクを押した人」）。
- [ ] 「告知の速さ」「自動投稿の状態」「今月の残り回数」等の**非表示項目が出ていない**。
- [ ] **一番効いた文面／強い時間帯／テンプレ別の勝率**のいずれかが表示（データ無は`—`表記）。
- [ ] **同接とクリックの推移（今日）**が1枚の折れ線として表示され、**告知マーカー**にホバーで本文先頭と推定増加が出る。
- [ ] **最近の告知（10件）**の列が「時刻｜文面（先頭）｜クリック｜増えた人（推定）｜結果」で、**「この文面でまた投稿」**が機能。
- [ ] アラートは**Xの連携が切れています／ブラウザ通知が無効です**のみ表示（他は出ない）。

### 7.2 レポート
- [ ] フィルタ（期間/テンプレート/バリアント/検索）が機能し、URLクエリに同期。
- [ ] テーブル列が「投稿ID｜日時｜テンプレート｜バリアント｜クリック｜増えた人（推定）｜変換率｜結果」で表示。
- [ ] 行詳細で**±15分の同接ミニグラフ**と**Raw Log**が見える。
- [ ] **CSVエクスポート**で上記列が含まれるファイルが生成される。
- [ ] 行アクション**「この文面でまた投稿」**で編集画面がプリセット起動。
- [ ] **インプレッション依存のCTRは表示されない**。

### 7.3 配信一覧
- [ ] テーブル列が「開始｜推定終了｜配信時間｜ピーク同接｜ピーク到達時間｜視聴時間概算」で表示。
- [ ] 行クリック（または詳細）でサンプル折れ線に**告知マーカー**が重ねて見える。
- [ ] 他プラットフォーム統計が**表示されない**（Twitchのみ）。

### 7.4 テンプレート
- [ ] 一覧に「テンプレート名／バリアント／使用回数／直近30日の勝率」が表示。
- [ ] エディタで本文に `{title} {category} {twitch_url}` が補完候補として挿入できる。
- [ ] **揺らぎON/OFF** と **プレビュー**が機能する。
- [ ] A/Bの配分が **50/50固定** で運用される（設定が存在しない）。
- [ ] 画像アップロードUIが**存在しない**（サムネはTwitchプレビュー or なし）。

### 7.5 連携
- [ ] **Xの接続/解除/再接続**が動作し、**権限**（`tweet.write users.read offline.access`）が表示される。
- [ ] **接続テスト**で疎通が確認でき、失効時は復旧ガイドが表示される。
- [ ] Discord/YouTubeのUIが**表示されない**。

### 7.6 設定
- [ ] **プロフィール**（Twitch同期）が**読み取り専用**で表示（表示名/アイコン等）。
- [ ] **通知（Web Push有効化）**がセットできる。
- [ ] **レビュー承認モード**の猶予タイマーと未承認時の挙動（自動投稿 or スキップ）が設定できる。
- [ ] **ログアウト**と**連携の解除（Twitch/X）**が機能する。
- [ ] **データの保持期間（90日）**の表示とエクスポートが動作。
- [ ] **アカウント削除**のUIが存在しない。

